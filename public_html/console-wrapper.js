$(function() {
  var term = $('#terminal-panel').terminal(function(command, term) {
    socket.emit('stdin', command);
  }, {
    clear: false,
    echoCommand: true,
    exit: false,
    greetings: 'Binary Wrapper\nCopyright (c) 2017 theKidOfArcrania\n',
    history: false,
    prompt: '',
    pauseEvents: false,
    onBlur: function() {
      return false;
    },
    scrollOnEcho: true,
    keymap: {
      'CTRL+D': function() {
        socket.emit("end");
      },
      'CTRL+C': function() {
        socket.emit("interrupt");
      }
    }
  });
  
  var socket = io('http://' + window.location.hostname + ':8081');
  socket.on('stdout', (msg) => {
    term.echo(msg);
  });
  socket.on('stderr', (msg) => {
    term.error(msg);
  });
  socket.on('connect', () => {
    socket.emit('start', 'test');
  });
  socket.on('connect_error', (error) => {
    term.error("Failure to connect to server: " + error);
  });
  socket.on('disconnect', () => {
    term.pause();
    term.echo("Connection has been disconnected. Refresh or reconnect to continue.");
    socket.disconnect();
  });
  
});